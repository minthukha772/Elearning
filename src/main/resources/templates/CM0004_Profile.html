<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extrasspringsecurity4"
>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css"
    />
    <link rel="stylesheet" href="/css/CM0004_Student Profile.css" />
    <title>Mapping Site</title>
  </head>

  <body style="background-color: #f0f0f0">
    <!-- guest user navi bar -->
    <div th:replace="fragments/nav"></div>

    <div class="container-custom mt-5">
      <!-- Successfully -->
      <div th:if="${message!=null}">
        <div
          class="alert alert-dismissible fade show"
          th:classappend="${message.isError?'alert-danger':'alert-success'}"
          role="alert"
        >
          <strong th:text="${message.isError?'Error! ':'Successful! '}">
          </strong>
          <span th:text="${message.text}"></span>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <div class="profile-pic-wrapper mb-3">
            <div class="pic-holder">
              <div class="d-flex justify-content-center">
                <div th:if="${profilePic ==null }">
                  <img
                    th:classappend="${isEditable?'uploadProfileInput':''}"
                    th:src="@{/images/profile.png}"
                    class="rounded-circle pic img-thumbnail profile_img"
                    width="150"
                    height="150"
                  />
                </div>
                <div th:unless="${profilePic == null }">
                  <img
                    th:classappend="${isEditable?'uploadProfileInput':''}"
                    th:src="${fileInfo.url}"
                    class="card-img-top"
                    th:alt="${fileInfo.name}"
                    height="150"
                    width="150"
                  />
                </div>
                <!-- TODO Come back for profile Upload -->
              </div>
            </div>
          </div>

          <div th:if="${isEditable}">
            <div class="d-flex justify-content-between">
              <h5>Personal Info</h5>
              <div sec:authorize="hasAuthority('ROLE_TEACHER')">
                <a class="btn btn-link" th:href="@{/teacher/profile_edit}"
                  >Edit</a
                >
              </div>
              <div sec:authorize="hasAuthority('ROLE_STUDENT')">
                <a class="btn btn-link" th:href="@{/student/profile_edit}"
                  >Edit</a
                >
              </div>
              <div
                sec:authorize="hasAuthority('ROLE_ADMIN') or hasAuthority('ROLE_SUPER_ADMIN')"
              >
                <a
                  class="btn btn-link"
                  th:href="@{/admin/profile_edit/{id}(id=${id})}"
                  >Edit</a
                >
              </div>
            </div>
          </div>

          <div th:if="${infoMap != null}">
            <div class="table-responsive mb-3">
              <table class="table table-borderless table-hover">
                <tr th:each="entry, stats : ${infoMap}">
                  <!-- <td th:text="${stats.index + 1}">1</td> -->
                  <td th:text="${entry.key}" class="text-end">100</td>
                  <td>:</td>
                  <td th:text="${entry.value}">John</td>
                </tr>
              </table>
            </div>
          </div>

          <div
            th:if="${certificateFiles!=null and !certificateFiles.empty and role=='ROLE_TEACHER'}"
          >
            <div class="d-flex justify-content-between">
              <h5>Award & Certificates</h5>

              <div th:if="${isEditable}">
                <div sec:authorize="hasAuthority('ROLE_TEACHER')">
                  <a
                    class="btn btn-link"
                    th:href="@{/teacher/manage_certificate}"
                    >Edit</a
                  >
                </div>
                <div
                  sec:authorize="hasAuthority('ROLE_ADMIN') or hasAuthority('ROLE_SUPER_ADMIN')"
                >
                  <a
                    class="btn btn-link"
                    th:href="@{/admin/profile_edit/{id}(id=${id})}"
                    >Edit</a
                  >
                </div>
              </div>
            </div>
            <div class="row row-cols-1 row-cols-md-3 g-4">
              <div class="col" th:each="fileInfo, stats : ${certificateFiles}">
                <!-- <div class="card h-100"> -->

                <a
                  data-fancybox="gallery"
                  th:href="${fileInfo.url}"
                  th:data-caption="${fileInfo.name}"
                >
                  <img
                    th:src="${fileInfo.url}"
                    class="card-img-top"
                    th:alt="${fileInfo.name}"
                  />
                </a>

                <!-- </div> -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="mt-3"
        sec:authorize="hasAuthority('ROLE_ADMIN') or hasAuthority('ROLE_SUPER_ADMIN') or hasAuthority('ROLE_TEACHER')"
      >
        <div class="card">
          <div class="card-header">User Account Control</div>
          <div class="card-body">
            <div class="d-flex justify-content-between mb-3">
              <p>Suspend User For A While</p>
              <button class="btn btn-primary">Suspend</button>
            </div>
            <div class="d-flex justify-content-between mb-3">
              <p>Re-activate User</p>
              <button class="btn btn-danger">Re-activate</button>
            </div>
            <div class="d-flex justify-content-between mb-3">
              <p>Delete User Account</p>
              <button class="btn btn-danger">Delete Account</button>
            </div>
          </div>
        </div>
      </div>

      <!-- If Role is ROLE_TEACHER -->
      <div
        class="d-flex justify-content-between"
        th:if="${role=='ROLE_TEACHER'}"
      >
        <div></div>
        <div>
          <!-- TODO redirect to Course List -->
          <a class="btn btn-primary mt-3 text-end" href="#">Browse Course</a>
        </div>
      </div>
    </div>

    <div th:replace="fragments/footer"></div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
      integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="
      crossorigin="anonymous"
    ></script>
    <script src="/js/photoPlaceHolder.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>
  </body>
</html>
